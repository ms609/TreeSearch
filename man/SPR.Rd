% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/SPR.R
\name{SPR}
\alias{SPR}
\alias{SPRMoves}
\alias{SPRMoves.phylo}
\alias{SPRMoves.matrix}
\alias{SPRSwap}
\alias{RootedSPR}
\alias{RootedSPRSwap}
\title{Subtree pruning and rearrangement (SPR)}
\usage{
SPR(tree, edgeToBreak = NULL, mergeEdge = NULL)

SPRMoves(tree, edgeToBreak = integer(0))

\method{SPRMoves}{phylo}(tree, edgeToBreak = integer(0))

\method{SPRMoves}{matrix}(tree, edgeToBreak = integer(0))

SPRSwap(
  parent,
  child,
  nEdge = length(parent),
  nNode = nEdge/2L,
  edgeToBreak = NULL,
  mergeEdge = NULL
)

RootedSPR(tree, edgeToBreak = NULL, mergeEdge = NULL)

RootedSPRSwap(
  parent,
  child,
  nEdge = length(parent),
  nNode = nEdge/2L,
  edgeToBreak = NULL,
  mergeEdge = NULL
)
}
\arguments{
\item{tree}{A tree of class \code{\link{phylo}}.}

\item{edgeToBreak}{the index of an edge to bisect, generated randomly
if not specified.}

\item{mergeEdge}{the index of an edge on which to merge the broken edge.}

\item{parent}{Integer vector corresponding to the first column of the edge
matrix of a tree of class \code{\link{phylo}}, i.e. \code{tree$edge[, 1]}.}

\item{child}{Integer vector corresponding to the second column of the edge
matrix of a tree of class \code{\link{phylo}}, i.e. \code{tree$edge[, 2]}.}

\item{nEdge}{(optional) integer specifying the number of edges of a tree of
class \code{\link{phylo}}, i.e. \code{dim(tree$edge)[1]}}

\item{nNode}{(optional) Number of nodes.}

\item{extension}{Numeric specifying the extension probability for the
SPR operation. If \code{NA} (the default), a random SPR operation is performed,
which will uniformly sample the neighbourhood of trees one SPR move from
\code{tree}, resulting in a Hastings Ratio of 1 \insertRef{Lakner2008}{TreeSearch}.}

\item{requireChange}{Logical specifying whether to require that the tree
topology changes.  If \code{FALSE}, a move may select the current branch as the
regrafting point.}
}
\value{
This function returns a tree in \code{phyDat} format that has
undergone one \acronym{SPR} iteration.

\code{TBRMoves()} returns a list of all trees one SPR move away from
\code{tree}, with edges and nodes in preorder, rooted on the first-labelled tip.

a list containing two elements, corresponding in turn to the
rearranged parent and child parameters

a list containing two elements, corresponding in turn to the rearranged parent and child parameters
}
\description{
Perform one \acronym{SPR} rearrangement on a tree
}
\details{
Note that rearrangements that only change the position of the root are
considered valid and \strong{will} be returned by \code{SPR}.
If the position of the root is irrelevant (as in Fitch parsimony, for example)
then this function will occasionally return a functionally equivalent topology.

All nodes in a tree must be bifurcating; \link[ape:collapse.singles]{ape::collapse.singles} and
\link[ape:multi2di]{ape::multi2di} may help.

The SPR operation begins by randomly selecting a branch in the tree.
One of the two subtrees defined by this edge is randomly selected to be
removed from the tree.
Under random SPR (rSPR, \code{extension = NA}), this
subtree is grafted onto a random branch in the remaining tree.
Under extension SPR (eSPR, \code{extension > 0}), a path through the random tree
is selected at random.
Starting from the current branch, each branch is considered as a regrafting
point with probability \code{1 - extension}. Once a branch is selected,
the pruned subtree is reattached on that branch, which is termed an
\emph{unconstrained} grafting point.
If no branch on the path is selected, the pruned subtree is reattached to the
final edge on that path, which is termed a \strong{constrained} grafting point.

Edge lengths are retained. The length of the edge that linked the
pruned subtree and its sister group to the rest of the tree is assigned
to the new edge that links the regrafted clade and its sister group to the
rest of the tree. (See fig. 6 in \insertRef{Lakner2008}{TreeSearch} for a
detailed explanation.)
}
\section{Functions}{
\itemize{
\item \code{SPRSwap()}: faster version that takes and returns parent and child parameters

\item \code{RootedSPR()}: Perform \acronym{SPR} rearrangement, retaining position of root

\item \code{RootedSPRSwap()}: faster version that takes and returns parent and child parameters

}}
\examples{
{
tree <- ape::rtree(20, br=FALSE)
SPR(tree)
}
}
\references{
The \acronym{SPR} algorithm is summarized in
\insertRef{Felsenstein2004;textual}{TreeSearch}.
The eSPR implementation is based on \insertRef{Lakner2008;textual}{TreeSearch}.
}
\seealso{
\itemize{
\item \code{kSPR()}, a slower implementation in the \pkg{phangorn} package.
\item \code{\link[=RootedSPR]{RootedSPR()}}: useful when the position of the root node should be retained.
}

Other tree rearrangement functions: 
\code{\link{NNI}()},
\code{\link{TBR}()}
}
\author{
Martin R. Smith
}
\concept{tree rearrangement functions}
