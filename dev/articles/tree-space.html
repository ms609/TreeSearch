<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started: Exploring tree space • TreeSearch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Getting started: Exploring tree space">
<meta property="og:description" content="TreeSearch">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-V9DV1LS35J"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-V9DV1LS35J');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TreeSearch</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.4.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Getting started</li>
    <li>
      <a href="../articles/getting-started.html">Getting started: Installing R and TreeSearch</a>
    </li>
    <li>
      <a href="../articles/tree-search.html">Getting started: Simple tree searches</a>
    </li>
    <li>
      <a href="../articles/tree-space.html">Getting started: Exploring tree space</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Advanced use</li>
    <li>
      <a href="../articles/profile-scores.html">Profile parsimony</a>
    </li>
    <li>
      <a href="../articles/profile.html">Tree search with Profile parsimony</a>
    </li>
    <li>
      <a href="../articles/custom.html">Tree search with custom optimality criteria</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ms609/TreeSearch/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started: Exploring tree space</h1>
                        <h4 data-toc-skip class="author">Martin R.
Smith</h4>
            
            <h4 data-toc-skip class="date">2024-04-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ms609/TreeSearch/blob/HEAD/vignettes/tree-space.Rmd" class="external-link"><code>vignettes/tree-space.Rmd</code></a></small>
      <div class="hidden name"><code>tree-space.Rmd</code></div>

    </div>

    
    
<p>Mapping the distribution of trees in “tree space” can reveal patterns
in the set of optimal trees, and allow additional details to be obtained
from results that may appear to lack resolution <span class="citation">(Smith, 2022a)</span>.</p>
<p>The ‘TreeSearch’ GUI allows rapid visualisation of tree spaces and
the construction of cluster consensus trees, to depict the underlying
structure inherent in a set of optimal trees.</p>
<p>More detailed tree space analysis can also be conducted using the <a href="https://ms609.github.io/TreeDist/articles/treespace.html" class="external-link">‘TreeDist’
package</a>.</p>
<div class="section level2">
<h2 id="loading-trees-into-the-gui">Loading trees into the GUI<a class="anchor" aria-label="anchor" href="#loading-trees-into-the-gui"></a>
</h2>
<p>This example uses the <span class="citation">Sun et al. (2018)</span>
dataset included with the TreeSearch package, which contains trees
generated under four optimality criteria. The approach will work on
search results generated by tree search within the GUI, or any set of
trees loaded using the “Load trees” function.</p>
<p>For rapid processing, large tree sets are down-sampled when loaded:
here, 48 of the 125 trees are used for analysis. This is useful for
obtaining an initial overview of results; including more trees gives a
more complete picture but results will take quadratically longer to
generate.</p>
<p>If loading the output of a Bayesian analysis, you may wish to modify
the range of trees sampled to exclude trees generated during the burn-in
phase.</p>
<div class="float">
<img src="gui_trees_loaded.png" alt="Loading trees for analysis"><div class="figcaption">Loading trees for analysis</div>
</div>
<p>Equivalent R code can be downloaded using the “Save plot: R script”
button, and is provided here for reference:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ms609.github.io/TreeTools/" class="external-link">"TreeTools"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ms609.github.io/TreeDist/" class="external-link">"TreeDist"</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ms609.github.io/TreeSearch/">"TreeSearch"</a></span><span class="op">)</span> </span>
<span>  </span>
<span></span>
<span><span class="co"># Load Sun et al. 2018 trees from TreeSearch package</span></span>
<span><span class="va">treeFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"datasets/Sun2018.nex"</span>, package <span class="op">=</span> <span class="st">"TreeSearch"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load trees from your own file with</span></span>
<span><span class="co"># treeFile &lt;- "Path/to/my.file"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># To check and set working directory, use:</span></span>
<span><span class="co"># getwd() # Should match location of data / tree files </span></span>
<span><span class="co"># setwd(".") # Replace . with desired/directory to change </span></span>
<span></span>
<span><span class="co"># Read all trees from file</span></span>
<span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span><span class="va">treeFile</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Down-sample to a maximum of 48 trees</span></span>
<span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="va">trees</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">48</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exploring-the-consensus">Exploring the consensus<a class="anchor" aria-label="anchor" href="#exploring-the-consensus"></a>
</h2>
<p>The GUI will initially display the strict consensus of the input
trees, after gaining as much information as possible by removing any
“rogue” taxa whose position is highly variable <span class="citation">(Smith, 2022b)</span>.</p>
<p>If trees were generated by a probabilistic sampling process
(e.g. Markov Chain) then a majority rule consensus (figure: Majority =
0.5) may reveal additional resolution, but note that the frequency of
splits in trees found by parsimony search does not correspond to split
support – only the strict consensus tree has any direct interpretation
in this setting.</p>
<div class="float">
<img src="gui_consensus.png" alt="A majority rule consensus has no interpretation with this dataset, but its improved resolution does hint that the strict consensus hides some underlying structure"><div class="figcaption">A majority rule consensus has no interpretation
with this dataset, but its improved resolution does hint that the strict
consensus hides some underlying structure</div>
</div>
<p>Equivalent R code can be downloaded using the “Save plot: R script”
button within the GUI, and is provided here for reference:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select an appropriate majority value</span></span>
<span><span class="co"># When analysing parsimony results, this value should be 1.</span></span>
<span><span class="va">majority</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="co"># Identify rogue taxa</span></span>
<span><span class="va">exclude</span> <span class="op">&lt;-</span> <span class="fu">Rogue</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rogue/man/RogueTaxa.html" class="external-link">QuickRogue</a></span><span class="op">(</span><span class="va">trees</span>, p <span class="op">=</span> <span class="va">majority</span><span class="op">)</span><span class="op">$</span><span class="va">taxon</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">exclude</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Paterimitra"         "Yuganotheca_elegans"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select a rogue whose positions should be depicted</span></span>
<span><span class="va">plottedRogue</span> <span class="op">&lt;-</span> <span class="va">exclude</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove other excluded taxa from tree</span></span>
<span><span class="va">consTrees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">trees</span>, <span class="va">DropTip</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">exclude</span>, <span class="va">plottedRogue</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Colour tip labels according to their original 'instability' (Smith 2022a)</span></span>
<span><span class="va">tipCols</span> <span class="op">&lt;-</span> <span class="fu">Rogue</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rogue/man/TipInstability.html" class="external-link">ColByStability</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Our plotted rogue will not appear on the tree</span></span>
<span><span class="va">tipCols</span> <span class="op">&lt;-</span> <span class="va">tipCols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">consTrees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tip.label</span>, <span class="va">plottedRogue</span><span class="op">)</span><span class="op">]</span> </span>
<span></span>
<span></span>
<span><span class="co"># Set up plotting area </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span></span>
<span> mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="co"># Zero margins </span></span>
<span> cex <span class="op">=</span> <span class="fl">0.8</span>            <span class="co"># Smaller font size </span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the reduced consensus tree, showing position of our plotted rogue </span></span>
<span><span class="va">plotted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/RoguePlot.html" class="external-link">RoguePlot</a></span><span class="op">(</span> </span>
<span> trees <span class="op">=</span> <span class="va">consTrees</span>, </span>
<span> tip <span class="op">=</span> <span class="va">plottedRogue</span>,</span>
<span> p <span class="op">=</span> <span class="va">majority</span>, </span>
<span> edgeLength <span class="op">=</span> <span class="fl">1</span>, </span>
<span> tip.color <span class="op">=</span> <span class="va">tipCols</span> </span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Calculate split concordance</span></span>
<span><span class="va">concordance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/SplitFrequency.html" class="external-link">SplitFrequency</a></span><span class="op">(</span><span class="va">plotted</span><span class="op">$</span><span class="va">cons</span>, <span class="va">trees</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Annotate splits by concordance </span></span>
<span><span class="fu"><a href="https://ms609.github.io/TreeTools/reference/LabelSplits.html" class="external-link">LabelSplits</a></span><span class="op">(</span></span>
<span> tree <span class="op">=</span> <span class="va">plotted</span><span class="op">$</span><span class="va">cons</span>,</span>
<span> labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">concordance</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span> col <span class="op">=</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/SupportColour.html" class="external-link">SupportColor</a></span><span class="op">(</span><span class="va">concordance</span><span class="op">)</span>,</span>
<span> frame <span class="op">=</span> <span class="st">"none"</span>,</span>
<span> pos <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-structure-of-tree-space">The structure of tree space<a class="anchor" aria-label="anchor" href="#the-structure-of-tree-space"></a>
</h2>
<p>The “Tree space” display option plots trees as points, and attempts
to map the distribution of points such that the distance between mapped
points corresponds to the tree distance between each pair of trees.</p>
<p>The default method (Clustering Information distance) has many
advantages over the widely-used Robinson–Foulds distance <span class="citation">(Smith, 2020, 2022a)</span>; the quartet distance,
whilst slower to calculate, can also produce good low-dimensional
mappings of tree space.</p>
<p>The number of dimensions of space can be reduced to make mappings
easier to interpret, but do check that the mapping quality gauge remains
at least “good”, or perceived structure may be an artefact of
distortion.</p>
<div class="float">
<img src="gui_sun_space.png" alt="Tree space mapping reveals three tree clusters"><div class="figcaption">Tree space mapping reveals three tree
clusters</div>
</div>
<p>In this dataset, trees are assigned to three distinct clusters, and
display “good” structure: clusters are marked only when their silhouette
coefficient is greater than the threshold, whose interpretation is
marked above the slider (here, 0.68 is “good”). As it happens, the
clusters largely correspond to the tree reconstruction method used:
<span class="citation">Fitch (1971)</span> parsimony (TNT_EW) trees form
one distinct cluster; trees under “BGS” inapplicable-corrected parsimony
<span class="citation">(Brazeau, Guillerme, &amp; Smith, 2019)</span>
another; and Bayesian trees a final, more diffuse cluster.</p>
<div class="section level3">
<h3 id="tree-space-analysis-in-r">Tree space analysis in R<a class="anchor" aria-label="anchor" href="#tree-space-analysis-in-r"></a>
</h3>
<p>More sophisticated tree space analysis can be conducted using the <a href="https://ms609.github.io/TreeDist/articles/treespace.html" class="external-link">‘TreeDist’
package</a>.</p>
<p>Sample R code can be downloaded using the “Save plot: R script”
button within the GUI, and is provided here for reference:</p>
</div>
<div class="section level3">
<h3 id="generate-distances">Generate distances<a class="anchor" aria-label="anchor" href="#generate-distances"></a>
</h3>
<p>Different tree distances reflect different aspects of tree
similarity, which may or may not be relevant to phylogenetic questions
<span class="citation">(Smith, 2020, 2022a)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute distances between pairs of trees</span></span>
<span><span class="va">dists</span> <span class="op">&lt;-</span> <span class="fu">TreeDist</span><span class="fu">::</span><span class="fu"><a href="https://ms609.github.io/TreeDist/reference/TreeDistance.html" class="external-link">ClusteringInfoDistance</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The quartet distance is a slower alternative:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ms609.github.io/Quartet/" class="external-link">"Quartet"</a></span><span class="op">)</span></span>
<span><span class="va">dists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fu">Quartet</span><span class="fu">::</span><span class="fu"><a href="https://ms609.github.io/Quartet/reference/SimilarityMetrics.html" class="external-link">QuartetDivergence</a></span><span class="op">(</span> </span>
<span>   <span class="fu">Quartet</span><span class="fu">::</span><span class="fu"><a href="https://ms609.github.io/Quartet/reference/QuartetStatus.html" class="external-link">ManyToManyQuartetAgreement</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>, similarity <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="identify-clustering-structure">Identify clustering structure<a class="anchor" aria-label="anchor" href="#identify-clustering-structure"></a>
</h3>
<p>Here we compute clusters of trees using a selection of clustering
methods <span class="citation">(Bien &amp; Tibshirani, 2011; Hartigan
&amp; Wong, 1979; Maechler, Rousseeuw, Struyf, Hubert, &amp; Hornik,
2019)</span>, allowing the optimal clustering to be highlighted on the
plot.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Try K-means clustering (Hartigan &amp; Wong 1979):</span></span>
<span><span class="va">kClusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="co"># Minimum 2 clusters; maximum 15</span></span>
<span>  <span class="kw">function</span> <span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">dists</span>, <span class="va">k</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">kSils</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">kClusters</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">kCluster</span><span class="op">)</span> <span class="op">{</span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html" class="external-link">silhouette</a></span><span class="op">(</span><span class="va">kCluster</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">dists</span><span class="op">)</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">bestK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">kSils</span><span class="op">)</span> </span>
<span><span class="va">kSil</span> <span class="op">&lt;-</span> <span class="va">kSils</span><span class="op">[</span><span class="va">bestK</span><span class="op">]</span> <span class="co"># Best silhouette coefficient </span></span>
<span><span class="va">kCluster</span> <span class="op">&lt;-</span> <span class="va">kClusters</span><span class="op">[[</span><span class="va">bestK</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">cluster</span> <span class="co"># Best solution </span></span>
<span></span>
<span><span class="co"># Try partitioning around medoids (Maechler et al. 2019):</span></span>
<span><span class="va">pamClusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/pam.html" class="external-link">pam</a></span><span class="op">(</span><span class="va">dists</span>, k <span class="op">=</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">pamSils</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">pamClusters</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">pamCluster</span><span class="op">)</span> <span class="op">{</span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html" class="external-link">silhouette</a></span><span class="op">(</span><span class="va">pamCluster</span><span class="op">)</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">bestPam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">pamSils</span><span class="op">)</span> </span>
<span><span class="va">pamSil</span> <span class="op">&lt;-</span> <span class="va">pamSils</span><span class="op">[</span><span class="va">bestPam</span><span class="op">]</span> <span class="co"># Best silhouette coefficient </span></span>
<span><span class="va">pamCluster</span> <span class="op">&lt;-</span> <span class="va">pamClusters</span><span class="op">[[</span><span class="va">bestPam</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">cluster</span> <span class="co"># Best solution </span></span>
<span></span>
<span><span class="co"># Try hierarchical clustering with minimax linkage (Bien &amp; Tibshirani 2011):</span></span>
<span><span class="va">hTree</span> <span class="op">&lt;-</span> <span class="fu">protoclust</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/protoclust/man/protoclust.html" class="external-link">protoclust</a></span><span class="op">(</span><span class="va">dists</span><span class="op">)</span> </span>
<span><span class="va">hClusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">15</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">hTree</span>, k <span class="op">=</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">hSils</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">hClusters</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">hCluster</span><span class="op">)</span> <span class="op">{</span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html" class="external-link">silhouette</a></span><span class="op">(</span><span class="va">hCluster</span>, <span class="va">dists</span><span class="op">)</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">bestH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">hSils</span><span class="op">)</span> </span>
<span><span class="va">hSil</span> <span class="op">&lt;-</span> <span class="va">hSils</span><span class="op">[</span><span class="va">bestH</span><span class="op">]</span> <span class="co"># Best silhouette coefficient </span></span>
<span><span class="va">hCluster</span> <span class="op">&lt;-</span> <span class="va">hClusters</span><span class="op">[[</span><span class="va">bestH</span><span class="op">]</span><span class="op">]</span> <span class="co"># Best solution</span></span>
<span></span>
<span><span class="co"># Set threshold for recognizing meaningful clustering </span></span>
<span><span class="co"># no support &lt; 0.25 &lt; weak &lt; 0.5 &lt; good &lt; 0.7 &lt; strong </span></span>
<span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="co"># Compare silhouette coefficients of each method </span></span>
<span><span class="va">bestMethodId</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">threshold</span>, <span class="va">pamSil</span>, <span class="va">hSil</span>, <span class="va">kSil</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">bestCluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"pam"</span>, <span class="st">"hmm"</span>, <span class="st">"kmn"</span><span class="op">)</span><span class="op">[</span><span class="va">bestMethodId</span><span class="op">]</span> </span>
<span></span>
<span><span class="co"># Best clustering:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Structure below threshold"</span>,</span>
<span>  <span class="st">"Partitioning around medoids"</span>,</span>
<span>  <span class="st">"Hierarchical-minimax"</span>,</span>
<span>  <span class="st">"K-means"</span><span class="op">)</span><span class="op">[</span><span class="va">bestMethodId</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "K-means"</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Best silhouette coefficient:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">threshold</span>, <span class="va">pamSil</span>, <span class="va">hSil</span>, <span class="va">kSil</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.601017</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store the cluster to which each tree is optimally assigned: </span></span>
<span><span class="va">clustering</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">bestCluster</span>, pam <span class="op">=</span> <span class="va">pamCluster</span>, hmm <span class="op">=</span> <span class="va">hCluster</span>, kmn <span class="op">=</span> <span class="va">kCluster</span>, <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="va">nClusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">clustering</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mapping-tree-space">Mapping tree space<a class="anchor" aria-label="anchor" href="#mapping-tree-space"></a>
</h3>
<p>Now we can map tree space into a few dimensions and visualise the
distribution of trees:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nDim</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># Number of dimensions to plot</span></span>
<span></span>
<span><span class="co"># Generate first dimensions of tree space using PCoA </span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html" class="external-link">cmdscale</a></span><span class="op">(</span><span class="va">dists</span>, k <span class="op">=</span> <span class="va">nDim</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Prepare plot layout </span></span>
<span><span class="va">nPanels</span> <span class="op">&lt;-</span> <span class="va">nDim</span> <span class="op">*</span> <span class="op">(</span><span class="va">nDim</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2L</span> <span class="co"># Lower-left triangle </span></span>
<span><span class="va">plotSeq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nDim</span>, <span class="va">nDim</span><span class="op">)</span></span>
<span><span class="va">plotSeq</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">plotSeq</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nPanels</span><span class="op">)</span></span>
<span><span class="va">plotSeq</span><span class="op">[</span><span class="va">nDim</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">plotSeq</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">plotSeq</span><span class="op">[</span><span class="op">-</span><span class="va">nDim</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set plot margins </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up tree plotting symbols</span></span>
<span><span class="va">treePch</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># Square</span></span>
<span><span class="va">clusterCol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html" class="external-link">palette.colors</a></span><span class="op">(</span><span class="va">nClusters</span>, <span class="st">"Alphabet"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">treeCols</span> <span class="op">&lt;-</span> <span class="va">clusterCol</span><span class="op">[</span><span class="va">clustering</span><span class="op">]</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">nDim</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  </span>
<span>  <span class="co"># Set up blank plot </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> </span>
<span>    x <span class="op">=</span> <span class="va">map</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span>, </span>
<span>    y <span class="op">=</span> <span class="va">map</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, </span>
<span>    ann <span class="op">=</span> <span class="cn">FALSE</span>,        <span class="co"># No annotations </span></span>
<span>    axes <span class="op">=</span> <span class="cn">FALSE</span>,       <span class="co"># No axes </span></span>
<span>    frame.plot <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Border around plot </span></span>
<span>    type <span class="op">=</span> <span class="st">"n"</span>,         <span class="co"># Don't plot any points yet </span></span>
<span>    asp <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># Fix aspect ratio to avoid distortion </span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span>,  <span class="co"># Constant X range for all dimensions </span></span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span>   <span class="co"># Constant Y range for all dimensions </span></span>
<span>  <span class="op">)</span> </span>
<span>   </span>
<span>  <span class="co"># Plot minimum spanning tree (Gower 1969) to depict distortion (Smith 2022)</span></span>
<span>  <span class="va">mst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/MSTEdges.html" class="external-link">MSTEdges</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dists</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span> </span>
<span>    x0 <span class="op">=</span> <span class="va">map</span><span class="op">[</span><span class="va">mst</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">j</span><span class="op">]</span>, </span>
<span>    y0 <span class="op">=</span> <span class="va">map</span><span class="op">[</span><span class="va">mst</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">i</span><span class="op">]</span>, </span>
<span>    x1 <span class="op">=</span> <span class="va">map</span><span class="op">[</span><span class="va">mst</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">j</span><span class="op">]</span>, </span>
<span>    y1 <span class="op">=</span> <span class="va">map</span><span class="op">[</span><span class="va">mst</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">i</span><span class="op">]</span>, </span>
<span>    col <span class="op">=</span> <span class="st">"#bbbbbb"</span>, <span class="co"># Light grey </span></span>
<span>    lty <span class="op">=</span> <span class="fl">1</span>          <span class="co"># Solid lines </span></span>
<span>  <span class="op">)</span> </span>
<span>   </span>
<span>  <span class="co"># Add points</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> </span>
<span>    x <span class="op">=</span> <span class="va">map</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span>, </span>
<span>    y <span class="op">=</span> <span class="va">map</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, </span>
<span>    pch <span class="op">=</span> <span class="va">treePch</span>, </span>
<span>    col <span class="op">=</span> <span class="va">treeCols</span>, </span>
<span>    cex <span class="op">=</span> <span class="fl">1.7</span>, <span class="co"># Point size </span></span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span> <span class="co"># Line width </span></span>
<span>  <span class="op">)</span> </span>
<span>   </span>
<span>  <span class="co"># Mark clusters </span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">clI</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nClusters</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> </span>
<span>    <span class="va">inCluster</span> <span class="op">&lt;-</span> <span class="va">clustering</span> <span class="op">==</span> <span class="va">clI</span> </span>
<span>    <span class="va">clusterX</span> <span class="op">&lt;-</span> <span class="va">map</span><span class="op">[</span><span class="va">inCluster</span>, <span class="va">j</span><span class="op">]</span> </span>
<span>    <span class="va">clusterY</span> <span class="op">&lt;-</span> <span class="va">map</span><span class="op">[</span><span class="va">inCluster</span>, <span class="va">i</span><span class="op">]</span> </span>
<span>    <span class="va">hull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/chull.html" class="external-link">chull</a></span><span class="op">(</span><span class="va">clusterX</span>, <span class="va">clusterY</span><span class="op">)</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span> </span>
<span>      x <span class="op">=</span> <span class="va">clusterX</span><span class="op">[</span><span class="va">hull</span><span class="op">]</span>, </span>
<span>      y <span class="op">=</span> <span class="va">clusterY</span><span class="op">[</span><span class="va">hull</span><span class="op">]</span>, </span>
<span>      lty <span class="op">=</span> <span class="fl">1</span>, <span class="co"># Solid line style </span></span>
<span>      lwd <span class="op">=</span> <span class="fl">2</span>, <span class="co"># Wider line width </span></span>
<span>      border <span class="op">=</span> <span class="va">clusterCol</span><span class="op">[</span><span class="va">clI</span><span class="op">]</span> </span>
<span>    <span class="op">)</span> </span>
<span>  <span class="op">}</span> </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="using-tree-clustering-to-understand-tree-space-structure">Using tree clustering to understand tree space structure<a class="anchor" aria-label="anchor" href="#using-tree-clustering-to-understand-tree-space-structure"></a>
</h2>
<p>Plotting the consensus of trees within a specific cluster can give
more insight into the underlying relationships within a tree set than
viewing a single strict consensus, particularly where the data do not
decisively distinguish between a small number of well-defined but
conflicting phylogenetic hypotheses <span class="citation">(Stockham,
Wang, &amp; Warnow, 2002)</span>.</p>
<p>Visualising the consensus of each cluster can reveal this “hidden”
agreement between trees and allow more detailed and thoughtful analysis
of the meaning of the phylogenetic output.</p>
<p>As the limited screen space available can render large trees
difficult to read, it may be helpful to output the analysis using the
“Save plot” options, either as an R script to allow further analysis
within R, or as a PDF for more comfortable on-screen viewing.</p>
<div class="float">
<img src="gui_cluster_cons.png" alt="Consensus of tree clusters"><div class="figcaption">Consensus of tree clusters</div>
</div>
<p>The R code below is modified from that output by the GUI, in order to
conduct rogue taxon analysis for each cluster separately. Note that it
draws on the results of the clustering analysis above.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select proportion for majority rule consensus trees</span></span>
<span><span class="co"># 1 is the appropriate value when parsimony trees are included</span></span>
<span><span class="va">majority</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Plot each consensus tree in turn: </span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nClusters</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">clusterTrees</span> <span class="op">&lt;-</span> <span class="va">trees</span><span class="op">[</span><span class="va">clustering</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span></span>
<span>  <span class="co"># Identify rogue taxa for this cluster</span></span>
<span>  <span class="va">clusterRogues</span> <span class="op">&lt;-</span> <span class="fu">Rogue</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rogue/man/RogueTaxa.html" class="external-link">QuickRogue</a></span><span class="op">(</span><span class="va">clusterTrees</span>, p <span class="op">=</span> <span class="va">majority</span><span class="op">)</span><span class="op">$</span><span class="va">taxon</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Colour tree labels based on stability across cluster</span></span>
<span>  <span class="va">tipCols</span> <span class="op">&lt;-</span> <span class="fu">Rogue</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rogue/man/TipInstability.html" class="external-link">ColByStability</a></span><span class="op">(</span><span class="va">clusterTrees</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">cons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/ConsensusWithout.html" class="external-link">ConsensusWithout</a></span><span class="op">(</span> </span>
<span>    trees <span class="op">=</span> <span class="va">clusterTrees</span>, </span>
<span>    tip <span class="op">=</span> <span class="va">clusterRogues</span>,</span>
<span>    p <span class="op">=</span> <span class="va">majority</span></span>
<span>  <span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># Root tree </span></span>
<span>  <span class="va">cons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/RootTree.html" class="external-link">RootTree</a></span><span class="op">(</span><span class="va">cons</span>, <span class="va">trees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tip.label</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Set unit edge lengths for viewing</span></span>
<span>  <span class="va">cons</span><span class="op">$</span><span class="va">edge.length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep.int</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cons</span><span class="op">$</span><span class="va">edge</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># Rotate nodes, to display clades in order of size </span></span>
<span>  <span class="va">cons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/SortTree.html" class="external-link">SortTree</a></span><span class="op">(</span><span class="va">cons</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">trees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Plot tree</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="co"># Set up plotting area</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> </span>
<span>    <span class="va">cons</span>, </span>
<span>    edge.width <span class="op">=</span> <span class="fl">2</span>,             <span class="co"># Widen lines </span></span>
<span>    font <span class="op">=</span> <span class="fl">3</span>,                   <span class="co"># Italicize labels </span></span>
<span>    cex <span class="op">=</span> <span class="fl">0.83</span>,                 <span class="co"># Shrink tip font size </span></span>
<span>    edge.color <span class="op">=</span> <span class="va">clusterCol</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="co"># Colour tree according to previous plot</span></span>
<span>    tip.color <span class="op">=</span> <span class="va">tipCols</span><span class="op">[</span><span class="va">cons</span><span class="op">$</span><span class="va">tip.label</span><span class="op">]</span> </span>
<span>  <span class="op">)</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"bottomright"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Cluster"</span>, <span class="va">i</span><span class="op">)</span>, </span>
<span>    pch <span class="op">=</span> <span class="fl">15</span>,            <span class="co"># Filled circle icon </span></span>
<span>    pt.cex <span class="op">=</span> <span class="fl">1.5</span>,        <span class="co"># Increase icon size </span></span>
<span>    col <span class="op">=</span> <span class="va">clusterCol</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>    bty <span class="op">=</span> <span class="st">"n"</span>            <span class="co"># Don't plot legend in box </span></span>
<span>  <span class="op">)</span> </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">clusterRogues</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Mark omitted taxa, if any rogues present</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>      <span class="st">"topright"</span>,</span>
<span>      <span class="va">clusterRogues</span>,</span>
<span>      col <span class="op">=</span> <span class="va">tipCols</span><span class="op">[</span><span class="va">clusterRogues</span><span class="op">]</span>,</span>
<span>      text.col <span class="op">=</span> <span class="va">tipCols</span><span class="op">[</span><span class="va">clusterRogues</span><span class="op">]</span>,</span>
<span>      pch <span class="op">=</span> <span class="st">"-"</span>,      <span class="co"># Mark as excluded</span></span>
<span>      cex <span class="op">=</span> <span class="fl">0.8</span>,      <span class="co"># Smaller font</span></span>
<span>      text.font <span class="op">=</span> <span class="fl">3</span>,  <span class="co"># Italicize</span></span>
<span>      bty <span class="op">=</span> <span class="st">"n"</span>       <span class="co"># Don't plot legend in box </span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="where-next">Where next?<a class="anchor" aria-label="anchor" href="#where-next"></a>
</h3>
<ul>
<li><p><a href="https://ms609.github.io/TreeSearch/">Documentation
home</a></p></li>
<li><p><a href="getting-started.html">Guide to installation</a></p></li>
<li>
<p>Search for trees using</p>
<ul>
<li>
<a href="tree-search.html">standard parsimony</a> (corrected for
inapplicable data)</li>
<li><a href="profile.html">profile parsimony</a></li>
<li><a href="custom.Rmd">custom optimality criteria</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-Bien2011" class="csl-entry">
Bien, J., &amp; Tibshirani, R. (2011). Hierarchical clustering with
prototypes via minimax linkage. <em>Journal of the American Statistical
Association</em>, <em>106</em>(495), 1075–1084. doi:<a href="https://doi.org/10.1198/jasa.2011.tm10183" class="external-link">10.1198/jasa.2011.tm10183</a>
</div>
<div id="ref-Brazeau2019" class="csl-entry">
Brazeau, M. D., Guillerme, T., &amp; Smith, M. R. (2019). <span class="nocase">An algorithm for morphological phylogenetic analysis with
inapplicable data</span>. <em>Systematic Biology</em>, <em>68</em>,
619–631. doi:<a href="https://doi.org/10.1093/sysbio/syy083" class="external-link">10.1093/sysbio/syy083</a>
</div>
<div id="ref-Fitch1971" class="csl-entry">
Fitch, W. M. (1971). Toward defining the course of evolution: Minimum
change for a specific tree topology. <em>Systematic Biology</em>,
<em>20</em>(4), 406–416. doi:<a href="https://doi.org/10.1093/sysbio/20.4.406" class="external-link">10.1093/sysbio/20.4.406</a>
</div>
<div id="ref-Hartigan1979" class="csl-entry">
Hartigan, J. A., &amp; Wong, M. A. (1979). Algorithm <span>AS</span>
136: A <span><em>K</em></span>-means clustering algorithm. <em>Journal
of the Royal Statistical Society. Series C (Applied Statistics)</em>,
<em>28</em>(1), 100–108. doi:<a href="https://doi.org/10.2307/2346830" class="external-link">10.2307/2346830</a>
</div>
<div id="ref-Maechler2019" class="csl-entry">
Maechler, M., Rousseeuw, P., Struyf, A., Hubert, M., &amp; Hornik, K.
(2019). Cluster: <span>Cluster Analysis Basics</span> and
<span>Extensions</span>. <em>Comprehensive R Archive Network</em>,
<em>2.1.0</em>.
</div>
<div id="ref-Smith2020" class="csl-entry">
Smith, M. R. (2020). Information theoretic <span>Generalized
Robinson-Foulds</span> metrics for comparing phylogenetic trees.
<em>Bioinformatics</em>, <em>36</em>(20), 5007–5013. doi:<a href="https://doi.org/10.1093/bioinformatics/btaa614" class="external-link">10.1093/bioinformatics/btaa614</a>
</div>
<div id="ref-SmithSpace" class="csl-entry">
Smith, M. R. (2022a). Robust analysis of phylogenetic tree space.
<em>Systematic Biology</em>, <em>71</em>(5), 1255–1270. doi:<a href="https://doi.org/10.1093/sysbio/syab100" class="external-link">10.1093/sysbio/syab100</a>
</div>
<div id="ref-SmithCons" class="csl-entry">
Smith, M. R. (2022b). Using information theory to detect rogue taxa and
improve consensus trees. <em>Systematic Biology</em>, <em>71</em>(5),
1088–1094. doi:<a href="https://doi.org/10.1093/sysbio/syab099" class="external-link">10.1093/sysbio/syab099</a>
</div>
<div id="ref-Stockham2002" class="csl-entry">
Stockham, C., Wang, L.-S., &amp; Warnow, T. (2002). Statistically based
postprocessing of phylogenetic analysis by clustering.
<em>Bioinformatics</em>, <em>18</em>(Suppl 1), S285–S293. doi:<a href="https://doi.org/10.1093/bioinformatics/18.suppl_1.S285" class="external-link">10.1093/bioinformatics/18.suppl_1.S285</a>
</div>
<div id="ref-Sun2018" class="csl-entry">
Sun, H.-J., Smith, M. R., Zeng, H., Zhao, F.-C., Li, G.-X., &amp; Zhu,
M.-Y. (2018). Hyoliths with pedicles illuminate the origin of the
brachiopod body plan. <em>Proceedings of the Royal Society B</em>,
<em>285</em>(1887), 20181780. doi:<a href="https://doi.org/10.1098/rspb.2018.1780" class="external-link">10.1098/rspb.2018.1780</a>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://smithlabdurham.github.io/" class="external-link">Martin R. Smith</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '8422cbc6478f9d3278ad355b48435342',
    indexName: 'treesearch',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
